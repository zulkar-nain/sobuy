{% extends "base.html" %}

{% block title %}All Orders - SoBuy Admin{% endblock %}

{% block content %}
<div class="bg-white rounded shadow p-6">
    <h2 class="text-2xl font-bold text-primary mb-4">All Orders</h2>
    {% if orders %}
    <div class="overflow-x-auto">
        <table class="min-w-full table-auto">
            <thead class="bg-gray-800 text-white">
                <tr>
                    <th class="px-4 py-2 text-left">Order ID</th>
                    <th class="px-4 py-2 text-left">Customer</th>
                    <th class="px-4 py-2 text-left">Status</th>
                    <th class="px-4 py-2 text-right">Amount</th>
                    <th class="px-4 py-2 text-left">Payment</th>
                    <th class="px-4 py-2 text-left">When</th>
                    <th class="px-4 py-2 text-left">Actions</th>
                </tr>
            </thead>
            <tbody class="text-gray-700">
                {% for o in orders %}
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2">#{{ o.id }}</td>
                    <td class="px-4 py-2">{% set user = (o.user_id and (User.query.get(o.user_id))) %}{% if user %}{{ user.username }}{% else %}Unknown{% endif %}</td>
                    <td class="px-4 py-2">
                        <form method="POST" action="{{ url_for('main.update_order_status', order_id=o.id) }}" class="flex items-center gap-2">
                            <select name="status" class="border rounded px-2 py-1 text-sm">
                                {% for st in ['Pending','Processing','Shipped','Completed','Cancelled'] %}
                                    <option value="{{ st }}" {% if st == o.status %}selected{% endif %}>{{ st }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="bg-primary text-white px-3 py-1 rounded text-sm">Update</button>
                        </form>
                    </td>
                    <td class="px-4 py-2 text-right">à§³{{ "%.2f"|format(o.total_amount) }}</td>
                    <td class="px-4 py-2">{{ o.payment_method }}{% if o.trx_id %} <span class="text-xs text-gray-500">(trx: {{ o.trx_id }})</span>{% endif %}</td>
                    <td class="px-4 py-2 text-sm">{{ o.created_at }}</td>
                    <td class="px-4 py-2">
                        <a href="{{ url_for('main.order_invoice', order_id=o.id) }}" class="text-sm text-blue-600 mr-2">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p>No orders found.</p>
    {% endif %}
</div>
{% endblock %}
